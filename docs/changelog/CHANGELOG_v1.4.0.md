# æ›´æ–°æ—¥å¿— v1.4.0

**å‘å¸ƒæ—¥æœŸ**: 2026-02-17  
**ç‰ˆæœ¬å·**: v1.4.0

---

## æ¦‚è¿°

v1.4.0 ç‰ˆæœ¬æ˜¯ä¸€ä¸ªé‡è¦çš„åŠŸèƒ½æ›´æ–°ç‰ˆæœ¬ï¼Œä¸»è¦èšç„¦äºç”¨æˆ·ä½“éªŒä¼˜åŒ–å’ŒåŠŸèƒ½å¢å¼ºã€‚æœ¬ç‰ˆæœ¬æ–°å¢äº†çƒ­é—¨æ–‡ç« æ’è¡Œã€æ–‡ç« ç½®é¡¶ã€ä¸Šä¸‹ç¯‡å¯¼èˆªã€æ¨èæ–‡ç« ç­‰åŠŸèƒ½ï¼ŒåŒæ—¶å¯¹ä¸»é¢˜ç³»ç»Ÿè¿›è¡Œäº†å…¨é¢å‡çº§ï¼Œæ”¯æŒè‡ªå®šä¹‰ä¸»è‰²è°ƒå’Œå­—ä½“å¤§å°è°ƒèŠ‚ã€‚ä¸ªäººä¸­å¿ƒé¡µé¢ä¹Ÿè¿›è¡Œäº†é‡æ„ï¼Œä¼˜åŒ–äº†ç”¨æˆ·äº¤äº’ä½“éªŒã€‚

---

## æ–°å¢åŠŸèƒ½

### ğŸ”¥ çƒ­é—¨æ–‡ç« æ’è¡Œ

- **é¦–é¡µå³ä¾§è¾¹æ æ–°å¢çƒ­é—¨æ–‡ç« æ’è¡Œæ¨¡å—**
  - æ›¿æ¢åŸæœ‰çš„å¿«é€Ÿå¯¼èˆªå’Œæ•°æ®ç»Ÿè®¡æ¨¡å—
  - æŒ‰æµè§ˆé‡æ’åºå±•ç¤ºçƒ­é—¨æ–‡ç« 
  - æ”¯æŒé…ç½®æ˜¾ç¤ºæ•°é‡ï¼ˆé»˜è®¤10ç¯‡ï¼‰
  - æ–°å¢ API æ¥å£ `GET /api/posts/hot`

### ğŸ“Œ æ–‡ç« ç½®é¡¶åŠŸèƒ½

- **æ”¯æŒå°†é‡è¦æ–‡ç« ç½®é¡¶æ˜¾ç¤º**
  - ç½®é¡¶æ–‡ç« åœ¨åˆ—è¡¨é¡¶éƒ¨ä¼˜å…ˆå±•ç¤º
  - ç®¡ç†åå°æ–‡ç« ç¼–è¾‘é¡µé¢æ–°å¢ç½®é¡¶é€‰é¡¹
  - æ”¯æŒå¤šç¯‡æ–‡ç« åŒæ—¶ç½®é¡¶
  - æ–°å¢æ•°æ®åº“å­—æ®µ `is_pinned`
  - æ–°å¢ API æ¥å£ `PUT /api/posts/:id/pin`
  - æ–°å¢æ•°æ®åº“è¿ç§»è„šæœ¬ `migration-v1.9-post-pinning.sql`

### ğŸ“– æ–‡ç« è¯¦æƒ…é¡µå¯¼èˆª

- **ä¸Šä¸‹ç¯‡æ–‡ç« å¯¼èˆª**
  - æ–‡ç« è¯¦æƒ…é¡µåº•éƒ¨æ–°å¢ä¸Šä¸€ç¯‡/ä¸‹ä¸€ç¯‡å¯¼èˆª
  - æ”¯æŒæŒ‰å‘å¸ƒæ—¶é—´é¡ºåºå¯¼èˆª
  - æ–°å¢ API æ¥å£ `GET /api/posts/:id/neighbors`

- **ç›¸å…³æ¨èæ–‡ç« **
  - æ–‡ç« è¯¦æƒ…é¡µåº•éƒ¨æ–°å¢ç›¸å…³æ¨èæ¨¡å—
  - åŸºäºåˆ†ç±»å’Œæ ‡ç­¾æ™ºèƒ½æ¨èç›¸å…³æ–‡ç« 
  - æ–°å¢ API æ¥å£ `GET /api/posts/:id/related`

### ğŸ“š é˜…è¯»å†å²é¡µé¢

- **æ–°å¢ç‹¬ç«‹é˜…è¯»å†å²é¡µé¢**
  - è·¯ç”±ï¼š`/reading-history`
  - å±•ç¤ºç”¨æˆ·æµè§ˆè¿‡çš„æ–‡ç« å†å²
  - æ”¯æŒåˆ†é¡µåŠ è½½
  - è®°å½•é˜…è¯»æ—¶é—´

### âš™ï¸ è´¦å·è®¾ç½®é¡µé¢

- **æ–°å¢ç‹¬ç«‹è´¦å·è®¾ç½®é¡µé¢**
  - è·¯ç”±ï¼š`/account-settings`
  - æ”¯æŒä¿®æ”¹å¯†ç 
  - æ”¯æŒä¿®æ”¹é‚®ç®±
  - æ”¯æŒè´¦å·åˆ é™¤ï¼ˆè½¯åˆ é™¤ï¼‰

### ğŸ¨ ä¸»é¢˜ç³»ç»Ÿå¢å¼º

- **è‡ªå®šä¹‰ä¸»è‰²è°ƒ**
  - æ”¯æŒç”¨æˆ·è‡ªå®šä¹‰ä¸»é¢˜ä¸»è‰²è°ƒ
  - æä¾›é¢„è®¾é¢œè‰²é€‰æ‹©
  - æ”¯æŒè‡ªå®šä¹‰é¢œè‰²è¾“å…¥
  - è®¾ç½®æŒä¹…åŒ–å­˜å‚¨åˆ° localStorage

- **å­—ä½“å¤§å°è°ƒèŠ‚**
  - æ”¯æŒä¸‰æ¡£å­—ä½“å¤§å°è°ƒèŠ‚ï¼ˆå°/ä¸­/å¤§ï¼‰
  - å…¨é¡µé¢å­—ä½“é€‚é…
  - è®¾ç½®æŒä¹…åŒ–å­˜å‚¨

- **å…¨é¡µé¢ä¸»é¢˜é€‚é…ä¼˜åŒ–**
  - æ‰€æœ‰é¡µé¢ç»„ä»¶é€‚é…äº®è‰²/æš—è‰²ä¸»é¢˜
  - ä¼˜åŒ–ä¸»é¢˜åˆ‡æ¢è¿‡æ¸¡åŠ¨ç”»
  - ä¿®å¤éƒ¨åˆ†é¡µé¢ä¸»é¢˜æ ·å¼ä¸ä¸€è‡´é—®é¢˜

---

## åŠŸèƒ½ä¼˜åŒ–

### ä¸ªäººä¸­å¿ƒé‡æ„

- **é¡µé¢ç»“æ„ä¼˜åŒ–**
  - åŸã€Œä¸ªäººèµ„æ–™ã€é¡µé¢æ”¹åä¸ºã€Œä¸ªäººä¸­å¿ƒã€
  - ç§»é™¤åŸæœ‰çš„å­é¡µé¢å¯¼èˆªï¼ˆä¸ªäººä¿¡æ¯ã€é˜…è¯»å†å²ã€è´¦å·è®¾ç½®ï¼‰
  - ä¸ªäººä¸­å¿ƒç›´æ¥å±•ç¤ºè¯„è®ºã€ç‚¹èµã€æ”¶è—ç­‰æ ‡ç­¾é¡µå†…å®¹
  - é˜…è¯»å†å²å’Œè´¦å·è®¾ç½®ç‹¬ç«‹ä¸ºå•ç‹¬é¡µé¢

### é¦–é¡µå¸ƒå±€ä¼˜åŒ–

- **å³ä¾§è¾¹æ é‡æ„**
  - ç§»é™¤å¿«é€Ÿå¯¼èˆªæ¨¡å—
  - ç§»é™¤æ•°æ®ç»Ÿè®¡æ¨¡å—
  - æ–°å¢çƒ­é—¨æ–‡ç« æ’è¡Œæ¨¡å—
  - ä¼˜åŒ–å¸ƒå±€é—´è·å’Œæ ·å¼

### æ–‡ç« åˆ—è¡¨ä¼˜åŒ–

- **ç½®é¡¶æ–‡ç« æ ‡è¯†**
  - ç½®é¡¶æ–‡ç« æ˜¾ç¤ºç½®é¡¶å›¾æ ‡
  - ç½®é¡¶æ–‡ç« æ ·å¼çªå‡ºæ˜¾ç¤º

### æ€§èƒ½ä¼˜åŒ–

- **å‰ç«¯æ€§èƒ½ä¼˜åŒ–**
  - ä¼˜åŒ–ç»„ä»¶æ¸²æŸ“æ€§èƒ½
  - å‡å°‘ä¸å¿…è¦çš„é‡æ¸²æŸ“
  - ä¼˜åŒ–å›¾ç‰‡åŠ è½½ç­–ç•¥

- **åç«¯æ€§èƒ½ä¼˜åŒ–**
  - æ–°å¢çƒ­é—¨æ–‡ç« ç¼“å­˜
  - ä¼˜åŒ–æ•°æ®åº“æŸ¥è¯¢ç´¢å¼•
  - æ–°å¢ `idx_posts_view_count` ç´¢å¼•
  - æ–°å¢ `idx_posts_is_pinned` ç´¢å¼•

---

## API å˜æ›´

### æ–°å¢æ¥å£

| æ¥å£ | æ–¹æ³• | è¯´æ˜ |
|------|------|------|
| `/api/posts/hot` | GET | è·å–çƒ­é—¨æ–‡ç« åˆ—è¡¨ |
| `/api/posts/:id/related` | GET | è·å–ç›¸å…³æ¨èæ–‡ç«  |
| `/api/posts/:id/neighbors` | GET | è·å–ä¸Šä¸‹ç¯‡æ–‡ç«  |
| `/api/posts/:id/pin` | PUT | åˆ‡æ¢æ–‡ç« ç½®é¡¶çŠ¶æ€ |

### æ¥å£å“åº”å˜æ›´

#### æ–‡ç« åˆ—è¡¨/è¯¦æƒ…æ¥å£

æ–°å¢å­—æ®µï¼š
- `isPinned`: boolean - æ˜¯å¦ç½®é¡¶

---

## æ•°æ®åº“å˜æ›´

### æ–°å¢å­—æ®µ

#### posts è¡¨

```sql
ALTER TABLE posts ADD COLUMN is_pinned INTEGER DEFAULT 0;
```

### æ–°å¢ç´¢å¼•

```sql
CREATE INDEX idx_posts_is_pinned ON posts(is_pinned DESC, published_at DESC);
CREATE INDEX idx_posts_view_count ON posts(view_count DESC);
```

### è¿ç§»è„šæœ¬

éœ€æ‰§è¡Œ `database/migration-v1.9-post-pinning.sql`

---

## å‰ç«¯ç»„ä»¶å˜æ›´

### æ–°å¢ç»„ä»¶

| ç»„ä»¶ | è·¯å¾„ | è¯´æ˜ |
|------|------|------|
| `HotPostsWidget` | `components/HotPostsWidget.tsx` | çƒ­é—¨æ–‡ç« æ’è¡Œç»„ä»¶ |
| `PostNavigation` | `components/PostNavigation.tsx` | ä¸Šä¸‹ç¯‡å¯¼èˆªç»„ä»¶ |
| `RecommendedPosts` | `components/RecommendedPosts.tsx` | æ¨èæ–‡ç« ç»„ä»¶ |

### æ–°å¢é¡µé¢

| é¡µé¢ | è·¯ç”± | è¯´æ˜ |
|------|------|------|
| `ReadingHistoryPage` | `/reading-history` | é˜…è¯»å†å²é¡µé¢ |
| `AccountSettingsPage` | `/account-settings` | è´¦å·è®¾ç½®é¡µé¢ |

### ä¿®æ”¹ç»„ä»¶

| ç»„ä»¶ | å˜æ›´è¯´æ˜ |
|------|---------|
| `HomePage` | å³ä¾§è¾¹æ é›†æˆçƒ­é—¨æ–‡ç« æ’è¡Œ |
| `PostPage` | æ–°å¢ä¸Šä¸‹ç¯‡å¯¼èˆªå’Œæ¨èæ–‡ç«  |
| `ProfilePage` | é‡æ„ä¸ºä¸ªäººä¸­å¿ƒï¼Œç§»é™¤å­é¡µé¢å¯¼èˆª |
| `Sidebar` | ç§»é™¤å¿«é€Ÿå¯¼èˆªå’Œæ•°æ®ç»Ÿè®¡æ¨¡å— |

### Store å˜æ›´

#### themeStore å¢å¼º

```typescript
interface ThemeState {
  mode: 'light' | 'dark' | 'system';
  primaryColor: string;      // æ–°å¢ï¼šè‡ªå®šä¹‰ä¸»è‰²è°ƒ
  fontSize: 'small' | 'medium' | 'large';  // æ–°å¢ï¼šå­—ä½“å¤§å°
  setMode: (mode: 'light' | 'dark' | 'system') => void;
  setPrimaryColor: (color: string) => void;  // æ–°å¢
  setFontSize: (size: 'small' | 'medium' | 'large') => void;  // æ–°å¢
}
```

---

## Bug ä¿®å¤

- ä¿®å¤ä¸»é¢˜åˆ‡æ¢æ—¶éƒ¨åˆ†ç»„ä»¶æ ·å¼é—ªçƒé—®é¢˜
- ä¿®å¤æ–‡ç« è¯¦æƒ…é¡µé˜…è¯»è¿›åº¦è®¡ç®—ä¸å‡†ç¡®é—®é¢˜
- ä¿®å¤ç§»åŠ¨ç«¯ä¾§è¾¹æ æ»šåŠ¨ç©¿é€é—®é¢˜
- ä¿®å¤è¯„è®ºå›å¤é€šçŸ¥å‘é€å¤±è´¥é—®é¢˜
- ä¿®å¤éƒ¨åˆ†é¡µé¢ SEO å…ƒæ•°æ®æœªæ­£ç¡®è®¾ç½®é—®é¢˜

---

## å‡çº§æŒ‡å—

### æ•°æ®åº“è¿ç§»

```bash
# æ‰§è¡Œç½®é¡¶åŠŸèƒ½è¿ç§»è„šæœ¬
wrangler d1 execute personal-blog-prod --file=database/migration-v1.9-post-pinning.sql
```

### å‰ç«¯æ›´æ–°

```bash
cd frontend
pnpm install
pnpm build
```

### åç«¯æ›´æ–°

```bash
cd backend
pnpm install
wrangler deploy
```

### æ¸…é™¤ç¼“å­˜ï¼ˆå¯é€‰ï¼‰

```bash
# æ¸…é™¤æ–‡ç« åˆ—è¡¨ç¼“å­˜
wrangler kv:key delete --binding CACHE --key="posts:list"
wrangler kv:key delete --binding CACHE --key="posts:hot"
```

---

## å…¼å®¹æ€§

- **Node.js**: 18.x, 20.x
- **æµè§ˆå™¨**: Chrome 90+, Firefox 88+, Safari 14+, Edge 90+
- **Cloudflare Workers**: å…¼å®¹
- **æ•°æ®åº“**: éœ€æ‰§è¡Œè¿ç§»è„šæœ¬

---

## è´¡çŒ®è€…

æ„Ÿè°¢æ‰€æœ‰ä¸ºæœ¬ç‰ˆæœ¬åšå‡ºè´¡çŒ®çš„å¼€å‘è€…ï¼

---

## ä¸‹ä¸€ç‰ˆæœ¬è®¡åˆ’

v1.5.0 ç‰ˆæœ¬è®¡åˆ’åŠŸèƒ½ï¼š

- [ ] å¤šè¯­è¨€æ”¯æŒï¼ˆi18nï¼‰
- [ ] æ–‡ç« ç›®å½•å¯¼èˆª
- [ ] é˜…è¯»è¿›åº¦æ¡
- [ ] æ–‡ç« å¯¼å‡ºåŠŸèƒ½ï¼ˆPDF/Markdownï¼‰
- [ ] æ›´å¤šä¸»é¢˜é…è‰²æ–¹æ¡ˆ

---

**ç‰ˆæœ¬**: v1.4.0 | **å‘å¸ƒæ—¥æœŸ**: 2026-02-17
