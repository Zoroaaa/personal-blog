# å¿«é€Ÿå¼€å§‹æŒ‡å—

æœ¬æ–‡æ¡£å°†å¸®åŠ©æ‚¨åœ¨ 10 åˆ†é’Ÿå†…å®Œæˆ Personal Blog åšå®¢ç³»ç»Ÿçš„æœ¬åœ°å¼€å‘å’Œéƒ¨ç½²é…ç½®ã€‚

**ç‰ˆæœ¬**: v1.4.0  
**æ›´æ–°æ—¥æœŸ**: 2026-02-17

---

## ç›®å½•

- [ç¯å¢ƒè¦æ±‚](#ç¯å¢ƒè¦æ±‚)
- [å®‰è£…æ­¥éª¤](#å®‰è£…æ­¥éª¤)
- [é…ç½®è¯´æ˜](#é…ç½®è¯´æ˜)
- [å¼€å‘æœåŠ¡å™¨](#å¼€å‘æœåŠ¡å™¨)
- [åŠŸèƒ½éªŒè¯](#åŠŸèƒ½éªŒè¯)
- [å¸¸è§é—®é¢˜](#å¸¸è§é—®é¢˜)

---

## ç¯å¢ƒè¦æ±‚

### å¿…éœ€è½¯ä»¶

| è½¯ä»¶ | æœ€ä½ç‰ˆæœ¬ | æ¨èç‰ˆæœ¬ | è¯´æ˜ |
|------|---------|---------|------|
| Node.js | 18.x | 20.x+ | JavaScript è¿è¡Œæ—¶ |
| pnpm | 8.x | 9.x+ | åŒ…ç®¡ç†å™¨ï¼ˆæ¨èï¼‰ |
| npm | 9.x | 10.x+ | åŒ…ç®¡ç†å™¨ï¼ˆå¤‡é€‰ï¼‰ |
| Git | 2.x | æœ€æ–°ç‰ˆ | ç‰ˆæœ¬æ§åˆ¶ |

### Cloudflare è´¦å·è¦æ±‚

æ‚¨éœ€è¦ä¸€ä¸ª Cloudflare è´¦å·ï¼Œå¹¶å¼€é€šä»¥ä¸‹æœåŠ¡ï¼š

- **Cloudflare Workers** - åç«¯è¿è¡Œç¯å¢ƒ
- **Cloudflare D1** - SQLite æ•°æ®åº“
- **Cloudflare KV** - é”®å€¼å­˜å‚¨ï¼ˆå¯é€‰ï¼Œç”¨äºç¼“å­˜ï¼‰
- **Cloudflare R2** - å¯¹è±¡å­˜å‚¨ï¼ˆå›¾ç‰‡ä¸Šä¼ ï¼‰
- **Cloudflare Pages** - å‰ç«¯æ‰˜ç®¡

> ğŸ’¡ æ‰€æœ‰æœåŠ¡éƒ½æœ‰å…è´¹é¢åº¦ï¼Œè¶³å¤Ÿä¸ªäººåšå®¢ä½¿ç”¨ã€‚

### ç¬¬ä¸‰æ–¹æœåŠ¡ï¼ˆå¯é€‰ï¼‰

| æœåŠ¡ | ç”¨é€” | æ˜¯å¦å¿…éœ€ |
|------|------|---------|
| Resend | é‚®ä»¶å‘é€ï¼ˆéªŒè¯ç ã€é€šçŸ¥ï¼‰ | æ¨è |
| GitHub OAuth | GitHub ç™»å½• | å¯é€‰ |
| è‡ªå®šä¹‰åŸŸå | ç”Ÿäº§ç¯å¢ƒéƒ¨ç½² | æ¨è |

---

## å®‰è£…æ­¥éª¤

### 1. å…‹éš†é¡¹ç›®

```bash
git clone https://github.com/yourusername/personal-blog.git
cd personal-blog
```

### 2. å®‰è£…ä¾èµ–

```bash
# å®‰è£…åç«¯ä¾èµ–
cd backend
pnpm install

# å®‰è£…å‰ç«¯ä¾èµ–
cd ../frontend
pnpm install
```

### 3. å®‰è£… Wrangler CLI

```bash
npm install -g wrangler
```

### 4. ç™»å½• Cloudflare

```bash
wrangler login
```

è¿™ä¼šæ‰“å¼€æµè§ˆå™¨è¿›è¡Œæˆæƒï¼Œå®Œæˆåå³å¯åœ¨æœ¬åœ°æ“ä½œ Cloudflare èµ„æºã€‚

---

## é…ç½®è¯´æ˜

### åç«¯é…ç½®

#### 1. åˆ›å»ºé…ç½®æ–‡ä»¶

```bash
cd backend
cp .env.example .env
```

#### 2. ç¼–è¾‘ `.env` æ–‡ä»¶

```env
# JWT å¯†é’¥ï¼ˆå¿…éœ€ï¼Œè¯·ä½¿ç”¨éšæœºå­—ç¬¦ä¸²ï¼‰
JWT_SECRET=your-super-secret-jwt-key-at-least-32-chars

# Resend API Keyï¼ˆç”¨äºé‚®ä»¶å‘é€ï¼‰
RESEND_API_KEY=re_xxxxxxxxxxxx

# GitHub OAuthï¼ˆå¯é€‰ï¼‰
GITHUB_CLIENT_ID=your-github-client-id
GITHUB_CLIENT_SECRET=your-github-client-secret

# å‰ç«¯åœ°å€ï¼ˆCORSé…ç½®ï¼‰
FRONTEND_URL=http://localhost:5173
```

#### 3. é…ç½® `wrangler.toml`

```bash
cp wrangler.toml.example wrangler.toml
```

ç¼–è¾‘ `wrangler.toml`ï¼š

```toml
name = "personal-blog-backend"
main = "src/index.ts"
compatibility_date = "2024-01-01"

[vars]
ENVIRONMENT = "development"

[[d1_databases]]
binding = "DB"
database_name = "personal-blog-dev"
database_id = "your-database-id"  # åˆ›å»ºæ•°æ®åº“åå¡«å…¥

[[r2_buckets]]
binding = "IMAGES"
bucket_name = "personal-blog-images-dev"

[[kv_namespaces]]
binding = "CACHE"
id = "your-kv-namespace-id"  # åˆ›å»ºKVåå¡«å…¥
```

### æ•°æ®åº“åˆå§‹åŒ–

#### 1. åˆ›å»º D1 æ•°æ®åº“

```bash
wrangler d1 create personal-blog-dev
```

æ‰§è¡Œåä¼šè¿”å›æ•°æ®åº“ IDï¼Œå°†å…¶å¡«å…¥ `wrangler.toml` çš„ `database_id` å­—æ®µã€‚

#### 2. æ‰§è¡Œæ•°æ®åº“è¿ç§»

æŒ‰é¡ºåºæ‰§è¡Œä»¥ä¸‹è¿ç§»è„šæœ¬ï¼š

```bash
# åŸºç¡€è¡¨ç»“æ„
wrangler d1 execute personal-blog-dev --file=../database/schema-v1.1-base.sql

# é€šçŸ¥å’Œç§ä¿¡ç³»ç»Ÿ
wrangler d1 execute personal-blog-dev --file=../database/schema-v1.3-notification-messaging.sql

# æ¶ˆæ¯æ’¤å›åŠŸèƒ½
wrangler d1 execute personal-blog-dev --file=../database/migration-v1.4-message-recall.sql

# æ–‡ç« ç½®é¡¶åŠŸèƒ½ï¼ˆv1.4.0æ–°å¢ï¼‰
wrangler d1 execute personal-blog-dev --file=../database/migration-v1.9-post-pinning.sql
```

#### 3. éªŒè¯æ•°æ®åº“

```bash
wrangler d1 execute personal-blog-dev --command="SELECT name FROM sqlite_master WHERE type='table'"
```

åº”è¿”å›ä»¥ä¸‹è¡¨ï¼š
- usersï¼ˆç”¨æˆ·è¡¨ï¼‰
- postsï¼ˆæ–‡ç« è¡¨ï¼‰
- columnsï¼ˆä¸“æ è¡¨ï¼‰
- categoriesï¼ˆåˆ†ç±»è¡¨ï¼‰
- tagsï¼ˆæ ‡ç­¾è¡¨ï¼‰
- commentsï¼ˆè¯„è®ºè¡¨ï¼‰
- post_likesï¼ˆç‚¹èµè¡¨ï¼‰
- post_favoritesï¼ˆæ”¶è—è¡¨ï¼‰
- reading_historyï¼ˆé˜…è¯»å†å²è¡¨ï¼‰
- notificationsï¼ˆé€šçŸ¥è¡¨ï¼‰
- messagesï¼ˆç§ä¿¡è¡¨ï¼‰
- message_threadsï¼ˆç§ä¿¡ä¼šè¯è¡¨ï¼‰
- notification_settingsï¼ˆé€šçŸ¥è®¾ç½®è¡¨ï¼‰
- message_settingsï¼ˆç§ä¿¡è®¾ç½®è¡¨ï¼‰
- system_notificationsï¼ˆç³»ç»Ÿé€šçŸ¥è¡¨ï¼‰
- configï¼ˆç³»ç»Ÿé…ç½®è¡¨ï¼‰

### R2 å­˜å‚¨æ¡¶é…ç½®

#### 1. åˆ›å»º R2 å­˜å‚¨æ¡¶

```bash
wrangler r2 bucket create personal-blog-images-dev
```

#### 2. é…ç½® CORSï¼ˆå¯é€‰ï¼‰

å¦‚éœ€åœ¨æµè§ˆå™¨ä¸­ç›´æ¥è®¿é—®å›¾ç‰‡ï¼Œé…ç½® R2 çš„ CORS è§„åˆ™ï¼š

```json
[
  {
    "AllowedOrigins": ["http://localhost:5173"],
    "AllowedMethods": ["GET", "PUT", "POST", "DELETE"],
    "AllowedHeaders": ["*"],
    "MaxAgeSeconds": 3600
  }
]
```

### KV å‘½åç©ºé—´é…ç½®ï¼ˆå¯é€‰ï¼‰

```bash
wrangler kv:namespace create CACHE
```

å°†è¿”å›çš„ ID å¡«å…¥ `wrangler.toml`ã€‚

### å‰ç«¯é…ç½®

#### 1. åˆ›å»ºé…ç½®æ–‡ä»¶

```bash
cd frontend
cp .env.example .env
```

#### 2. ç¼–è¾‘ `.env` æ–‡ä»¶

```env
# åç«¯ API åœ°å€
VITE_API_URL=http://localhost:8787

# æ˜¯å¦å¼€å¯è°ƒè¯•æ¨¡å¼
VITE_DEBUG=true
```

---

## å¼€å‘æœåŠ¡å™¨

### å¯åŠ¨åç«¯

```bash
cd backend
pnpm dev
```

åç«¯æœåŠ¡å°†åœ¨ `http://localhost:8787` å¯åŠ¨ã€‚

### å¯åŠ¨å‰ç«¯

æ‰“å¼€æ–°ç»ˆç«¯ï¼š

```bash
cd frontend
pnpm dev
```

å‰ç«¯æœåŠ¡å°†åœ¨ `http://localhost:5173` å¯åŠ¨ã€‚

### éªŒè¯æœåŠ¡

1. è®¿é—® `http://localhost:5173`
2. ç‚¹å‡»å³ä¸Šè§’ã€Œç™»å½•ã€
3. ç‚¹å‡»ã€Œæ³¨å†Œã€åˆ›å»ºç®¡ç†å‘˜è´¦å·
4. ç™»å½•åè®¿é—® `/admin` è¿›å…¥ç®¡ç†åå°

---

## åŠŸèƒ½éªŒè¯

### v1.4.0 æ–°åŠŸèƒ½éªŒè¯æ¸…å•

#### çƒ­é—¨æ–‡ç« æ’è¡Œ

1. è®¿é—®é¦–é¡µ
2. æŸ¥çœ‹å³ä¾§è¾¹æ ã€Œçƒ­é—¨æ–‡ç« æ’è¡Œã€æ¨¡å—
3. ç¡®è®¤æ˜¾ç¤ºæµè§ˆé‡æœ€é«˜çš„æ–‡ç« åˆ—è¡¨

#### æ–‡ç« ç½®é¡¶

1. ä»¥ç®¡ç†å‘˜èº«ä»½ç™»å½•
2. è¿›å…¥ç®¡ç†åå° â†’ æ–‡ç« ç®¡ç†
3. ç¼–è¾‘ä»»æ„æ–‡ç« ï¼Œå‹¾é€‰ã€Œç½®é¡¶ã€é€‰é¡¹
4. ä¿å­˜åè¿”å›é¦–é¡µï¼Œç¡®è®¤ç½®é¡¶æ–‡ç« æ˜¾ç¤ºåœ¨åˆ—è¡¨é¡¶éƒ¨

#### ä¸Šä¸‹ç¯‡å¯¼èˆª

1. ç‚¹å‡»ä»»æ„æ–‡ç« è¿›å…¥è¯¦æƒ…é¡µ
2. æ»šåŠ¨åˆ°æ–‡ç« åº•éƒ¨
3. ç¡®è®¤æ˜¾ç¤ºã€Œä¸Šä¸€ç¯‡ã€ã€Œä¸‹ä¸€ç¯‡ã€å¯¼èˆªé“¾æ¥

#### æ¨èæ–‡ç« 

1. åœ¨æ–‡ç« è¯¦æƒ…é¡µåº•éƒ¨
2. ç¡®è®¤æ˜¾ç¤ºã€Œç›¸å…³æ¨èã€æ–‡ç« åˆ—è¡¨

#### é˜…è¯»å†å²é¡µé¢

1. é˜…è¯»å‡ ç¯‡æ–‡ç« 
2. ç‚¹å‡»å¯¼èˆªæ ã€Œé˜…è¯»å†å²ã€
3. ç¡®è®¤æ˜¾ç¤ºå·²é˜…è¯»æ–‡ç« åˆ—è¡¨

#### è´¦å·è®¾ç½®é¡µé¢

1. ç‚¹å‡»ç”¨æˆ·å¤´åƒ â†’ ã€Œè´¦å·è®¾ç½®ã€
2. ç¡®è®¤å¯ä»¥ä¿®æ”¹å¯†ç ã€é‚®ç®±ç­‰è´¦å·ä¿¡æ¯

#### ä¸ªäººä¸­å¿ƒ

1. ç‚¹å‡»ç”¨æˆ·å¤´åƒ â†’ ã€Œä¸ªäººä¸­å¿ƒã€
2. ç¡®è®¤æ˜¾ç¤ºè¯„è®ºã€ç‚¹èµã€æ”¶è—ç­‰æ ‡ç­¾é¡µ
3. ç¡®è®¤ä¸å†æœ‰å­é¡µé¢å¯¼èˆª

#### ä¸»é¢˜è®¾ç½®

1. ç‚¹å‡»å³ä¸Šè§’ä¸»é¢˜åˆ‡æ¢æŒ‰é’®
2. ç¡®è®¤å¯ä»¥åˆ‡æ¢äº®è‰²/æš—è‰²æ¨¡å¼
3. ç¡®è®¤å¯ä»¥è°ƒæ•´ä¸»è‰²è°ƒ
4. ç¡®è®¤å¯ä»¥è°ƒæ•´å­—ä½“å¤§å°
5. åˆ·æ–°é¡µé¢åè®¾ç½®åº”ä¿æŒ

### åŸºç¡€åŠŸèƒ½éªŒè¯

- [ ] ç”¨æˆ·æ³¨å†Œ/ç™»å½•
- [ ] æ–‡ç« åˆ›å»º/ç¼–è¾‘/åˆ é™¤
- [ ] Markdown æ¸²æŸ“
- [ ] ä»£ç é«˜äº®
- [ ] å›¾ç‰‡ä¸Šä¼ 
- [ ] è¯„è®ºå‘å¸ƒ
- [ ] æ–‡ç« ç‚¹èµ/æ”¶è—
- [ ] åˆ†ç±»/æ ‡ç­¾ç­›é€‰
- [ ] å…¨æ–‡æœç´¢
- [ ] é€šçŸ¥ä¸­å¿ƒ
- [ ] ç§ä¿¡åŠŸèƒ½

---

## å¸¸è§é—®é¢˜

### Q: æ•°æ®åº“è¿ç§»å¤±è´¥ï¼Ÿ

**A**: ç¡®ä¿æŒ‰é¡ºåºæ‰§è¡Œè¿ç§»è„šæœ¬ï¼Œä¸”æ•°æ®åº“ ID æ­£ç¡®é…ç½®åœ¨ `wrangler.toml` ä¸­ã€‚

```bash
# æ£€æŸ¥æ•°æ®åº“åˆ—è¡¨
wrangler d1 list

# æŸ¥çœ‹æ•°æ®åº“è¯¦æƒ…
wrangler d1 info personal-blog-dev
```

### Q: å›¾ç‰‡ä¸Šä¼ å¤±è´¥ï¼Ÿ

**A**: æ£€æŸ¥ R2 å­˜å‚¨æ¡¶æ˜¯å¦æ­£ç¡®åˆ›å»ºï¼š

```bash
wrangler r2 bucket list
```

ç¡®è®¤ `wrangler.toml` ä¸­çš„ bucket_name æ­£ç¡®ã€‚

### Q: é‚®ä»¶å‘é€å¤±è´¥ï¼Ÿ

**A**: 
1. ç¡®è®¤ Resend API Key æ­£ç¡®é…ç½®
2. æ£€æŸ¥ Resend è´¦å·æ˜¯å¦å·²éªŒè¯åŸŸå
3. å¼€å‘ç¯å¢ƒå¯ä½¿ç”¨ Resend çš„æµ‹è¯•é‚®ç®±

### Q: GitHub OAuth ç™»å½•å¤±è´¥ï¼Ÿ

**A**: 
1. ç¡®è®¤ GitHub OAuth åº”ç”¨é…ç½®æ­£ç¡®
2. å›è°ƒåœ°å€åº”è®¾ç½®ä¸ºï¼š`http://localhost:5173/auth/callback`
3. æ£€æŸ¥ Client ID å’Œ Client Secret æ˜¯å¦æ­£ç¡®

### Q: å‰ç«¯æ— æ³•è¿æ¥åç«¯ï¼Ÿ

**A**: 
1. ç¡®è®¤åç«¯æœåŠ¡å·²å¯åŠ¨
2. æ£€æŸ¥ `VITE_API_URL` é…ç½®
3. æ£€æŸ¥ CORS é…ç½®

### Q: ä¸»é¢˜è®¾ç½®ä¸ç”Ÿæ•ˆï¼Ÿ

**A**: 
1. æ¸…é™¤æµè§ˆå™¨ç¼“å­˜
2. æ£€æŸ¥ localStorage ä¸­æ˜¯å¦æœ‰ theme ç›¸å…³æ•°æ®
3. ç¡®è®¤ themeStore æ­£ç¡®åˆå§‹åŒ–

### Q: ç½®é¡¶æ–‡ç« ä¸æ˜¾ç¤ºï¼Ÿ

**A**: 
1. ç¡®è®¤å·²æ‰§è¡Œ `migration-v1.9-post-pinning.sql` è¿ç§»
2. æ£€æŸ¥ posts è¡¨æ˜¯å¦æœ‰ `is_pinned` å­—æ®µ
3. ç¡®è®¤æ–‡ç« çš„ `is_pinned` å€¼ä¸º 1

---

## ä¸‹ä¸€æ­¥

- ğŸ“– é˜…è¯» [API æ–‡æ¡£](./API.md) äº†è§£æ¥å£è¯¦æƒ…
- ğŸš€ é˜…è¯» [éƒ¨ç½²æŒ‡å—](./DEPLOYMENT.md) éƒ¨ç½²åˆ°ç”Ÿäº§ç¯å¢ƒ
- ğŸ—ï¸ é˜…è¯» [æ¶æ„æ–‡æ¡£](./ARCHITECTURE.md) äº†è§£ç³»ç»Ÿè®¾è®¡

---

**ç‰ˆæœ¬**: v1.4.0 | **æ›´æ–°æ—¥æœŸ**: 2026-02-17
