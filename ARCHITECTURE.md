# ğŸ—ï¸ é¡¹ç›®æ¶æ„å’ŒæŠ€æœ¯è¯¦è§£

> åšå®¢ç³»ç»Ÿ v3.0 çš„å®Œæ•´æŠ€æœ¯æ¶æ„ã€è®¾è®¡å†³ç­–å’Œå®ç°ç»†èŠ‚

**ä½“éªŒç«™ç‚¹**: [blog.neutronx.uk](https://blog.neutronx.uk)

---

## ğŸ“‹ ç›®å½•

- [ç³»ç»Ÿæ¶æ„](#ç³»ç»Ÿæ¶æ„)
- [æŠ€æœ¯é€‰å‹](#æŠ€æœ¯é€‰å‹)
- [æ•°æ®åº“è®¾è®¡](#æ•°æ®åº“è®¾è®¡)
- [åç«¯æ¶æ„](#åç«¯æ¶æ„)
- [å‰ç«¯æ¶æ„](#å‰ç«¯æ¶æ„)
- [å®‰å…¨è®¾è®¡](#å®‰å…¨è®¾è®¡)
- [æ€§èƒ½ä¼˜åŒ–](#æ€§èƒ½ä¼˜åŒ–)
- [éƒ¨ç½²æ¶æ„](#éƒ¨ç½²æ¶æ„)
- [å¼€å‘è§„èŒƒ](#å¼€å‘è§„èŒƒ)

---

## ğŸ¯ ç³»ç»Ÿæ¶æ„

### æ•´ä½“æ¶æ„å›¾

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                         ç”¨æˆ·å±‚ (Clients)                          â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”        â”‚
â”‚  â”‚  æµè§ˆå™¨   â”‚  â”‚  ç§»åŠ¨ç«¯   â”‚  â”‚  çˆ¬è™«    â”‚  â”‚  RSSé˜…è¯»å™¨â”‚        â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                               â”‚ HTTPS
                               â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                   Cloudflare Global Network                      â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                â”‚
â”‚  â”‚   CDN      â”‚  â”‚   DDoS     â”‚  â”‚    WAF     â”‚                â”‚
â”‚  â”‚  ç¼“å­˜åŠ é€Ÿ   â”‚  â”‚   é˜²æŠ¤     â”‚  â”‚  åº”ç”¨é˜²ç«å¢™ â”‚                â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
             â”‚                          â”‚
             â–¼                          â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Cloudflare Pages      â”‚  â”‚  Cloudflare Workers    â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚   React App      â”‚  â”‚  â”‚  â”‚   Hono API       â”‚  â”‚
â”‚  â”‚   - è·¯ç”±         â”‚  â”‚  â”‚  â”‚   - REST API     â”‚  â”‚
â”‚  â”‚   - ç»„ä»¶         â”‚  â”‚  â”‚  â”‚   - ä¸­é—´ä»¶       â”‚  â”‚
â”‚  â”‚   - çŠ¶æ€ç®¡ç†     â”‚  â”‚  â”‚  â”‚   - ä¸šåŠ¡é€»è¾‘     â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                        â”‚  â”‚                        â”‚
â”‚  é™æ€èµ„æºæ‰˜ç®¡           â”‚  â”‚  è¾¹ç¼˜è®¡ç®—              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                     â”‚
                 â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                 â–¼                   â–¼                   â–¼
         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
         â”‚  D1 Database  â”‚  â”‚  KV Storage   â”‚  â”‚  R2 Storage   â”‚
         â”‚               â”‚  â”‚               â”‚  â”‚               â”‚
         â”‚  - SQLite     â”‚  â”‚  - ç¼“å­˜æ•°æ®   â”‚  â”‚  - å›¾ç‰‡æ–‡ä»¶   â”‚
         â”‚  - å…³ç³»æ•°æ®   â”‚  â”‚  - Session    â”‚  â”‚  - åª’ä½“èµ„æº   â”‚
         â”‚  - ç´¢å¼•ä¼˜åŒ–   â”‚  â”‚  - Tokené»‘åå•â”‚  â”‚  - å¤‡ä»½æ–‡ä»¶   â”‚
         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### è¯·æ±‚æµç¨‹

```
ç”¨æˆ·è¯·æ±‚
   â”‚
   â–¼
Cloudflare Edge
   â”‚
   â”œâ”€ é™æ€èµ„æº? â”€â”€yesâ”€â”€> Pages (React)
   â”‚                       â”‚
   â”‚                       â””â”€> è¿”å› HTML/CSS/JS
   â”‚
   â””â”€ APIè¯·æ±‚? â”€â”€yesâ”€â”€> Workers (Hono)
                           â”‚
                           â”œâ”€> é€Ÿç‡é™åˆ¶æ£€æŸ¥
                           â”‚
                           â”œâ”€> CORSéªŒè¯
                           â”‚
                           â”œâ”€> JWTè®¤è¯ï¼ˆå¯é€‰ï¼‰
                           â”‚
                           â”œâ”€> KVç¼“å­˜æŸ¥è¯¢
                           â”‚   â”‚
                           â”‚   â”œâ”€> å‘½ä¸­ â”€â”€> è¿”å›ç¼“å­˜
                           â”‚   â”‚
                           â”‚   â””â”€> æœªå‘½ä¸­ â”€â”€> ç»§ç»­
                           â”‚
                           â”œâ”€> ä¸šåŠ¡é€»è¾‘å¤„ç†
                           â”‚   â”‚
                           â”‚   â”œâ”€> æ•°æ®åº“æŸ¥è¯¢ (D1)
                           â”‚   â”‚
                           â”‚   â””â”€> æ–‡ä»¶æ“ä½œ (R2)
                           â”‚
                           â”œâ”€> å†™å…¥ç¼“å­˜ (KV)
                           â”‚
                           â””â”€> è¿”å› JSONå“åº”
```

---

## ğŸ› ï¸ æŠ€æœ¯é€‰å‹

### æŠ€æœ¯æ ˆå¯¹æ¯”å’Œé€‰æ‹©ç†ç”±

#### å‰ç«¯æ¡†æ¶

| æ¡†æ¶ | ä¼˜åŠ¿ | åŠ£åŠ¿ | é€‰æ‹© |
|------|------|------|------|
| **React** | ç”Ÿæ€ä¸°å¯Œã€ç»„ä»¶åŒ–ã€æ€§èƒ½å¥½ | å­¦ä¹ æ›²çº¿ | âœ… é€‰ç”¨ |
| Vue | æ˜“å­¦ã€æ–‡æ¡£å¥½ | ç”Ÿæ€ç›¸å¯¹å° | âŒ |
| Angular | ä¼ä¸šçº§ã€å®Œæ•´ | è¿‡äºå¤æ‚ | âŒ |

**é€‰æ‹© React çš„åŸå› **:
- å¼ºå¤§çš„ç”Ÿæ€ç³»ç»Ÿï¼ˆåº“ã€å·¥å…·ã€ç¤¾åŒºï¼‰
- ä¼˜ç§€çš„æ€§èƒ½ï¼ˆVirtual DOMï¼‰
- çµæ´»çš„æ¶æ„è®¾è®¡
- TypeScript æ”¯æŒå®Œå–„
- Cloudflare Pages åŸç”Ÿæ”¯æŒ

#### åç«¯æ¡†æ¶

| æ¡†æ¶ | ä¼˜åŠ¿ | åŠ£åŠ¿ | é€‰æ‹© |
|------|------|------|------|
| **Hono** | è½»é‡ã€å¿«é€Ÿã€Workersä¼˜åŒ– | ç›¸å¯¹æ–° | âœ… é€‰ç”¨ |
| Express | æˆç†Ÿã€ç”Ÿæ€å¥½ | ä¸é€‚åˆè¾¹ç¼˜è®¡ç®— | âŒ |
| Fastify | æ€§èƒ½å¥½ | Workersæ”¯æŒæœ‰é™ | âŒ |

**é€‰æ‹© Hono çš„åŸå› **:
- ä¸“ä¸º Cloudflare Workers ä¼˜åŒ–
- æè‡´çš„æ€§èƒ½ï¼ˆæ¯” Express å¿« 4xï¼‰
- TypeScript åŸç”Ÿæ”¯æŒ
- ä¸­é—´ä»¶ç³»ç»Ÿå®Œå–„
- ä½“ç§¯å°ï¼ˆ~12KBï¼‰

#### æ•°æ®åº“

| æ–¹æ¡ˆ | ä¼˜åŠ¿ | åŠ£åŠ¿ | é€‰æ‹© |
|------|------|------|------|
| **D1** | å…è´¹ã€åˆ†å¸ƒå¼ã€SQL | Betaé˜¶æ®µ | âœ… é€‰ç”¨ |
| KV | æå¿«ã€å…¨çƒåˆ†å¸ƒ | NoSQLã€æœ‰é™æŸ¥è¯¢ | âœ… è¾…åŠ© |
| PostgreSQL | åŠŸèƒ½å¼ºå¤§ | éœ€è¦æœåŠ¡å™¨ | âŒ |

**é€‰æ‹© D1 çš„åŸå› **:
- å®Œå…¨å…è´¹ï¼ˆåœ¨é¢åº¦å†…ï¼‰
- åŸç”Ÿ SQL æ”¯æŒ
- è‡ªåŠ¨å¤‡ä»½å’Œå¤åˆ¶
- ä¸ Workers æ·±åº¦é›†æˆ
- æ— éœ€è¿ç»´

#### æ ·å¼æ–¹æ¡ˆ

| æ–¹æ¡ˆ | ä¼˜åŠ¿ | åŠ£åŠ¿ | é€‰æ‹© |
|------|------|------|------|
| **Tailwind CSS** | å¿«é€Ÿå¼€å‘ã€å“åº”å¼ã€å¯å®šåˆ¶ | HTML å†—é•¿ | âœ… é€‰ç”¨ |
| CSS Modules | éš”ç¦»å¥½ | éœ€è¦å†™CSS | âŒ |
| Styled Components | JSä¸­å†™æ ·å¼ | æ€§èƒ½å¼€é”€ | âŒ |

**é€‰æ‹© Tailwind çš„åŸå› **:
- å¼€å‘æ•ˆç‡æé«˜
- å“åº”å¼è®¾è®¡ç®€å•
- ä¸»é¢˜å®šåˆ¶çµæ´»
- ç”Ÿäº§æ„å»ºè‡ªåŠ¨ä¼˜åŒ–
- è®¾è®¡ç³»ç»Ÿä¸€è‡´æ€§å¥½

#### çŠ¶æ€ç®¡ç†

| æ–¹æ¡ˆ | ä¼˜åŠ¿ | åŠ£åŠ¿ | é€‰æ‹© |
|------|------|------|------|
| **Zustand** | ç®€å•ã€è½»é‡ã€æ— æ ·æ¿ä»£ç  | ç”Ÿæ€ç›¸å¯¹å° | âœ… é€‰ç”¨ |
| Redux | æˆç†Ÿã€ç”Ÿæ€å¥½ | æ ·æ¿ä»£ç å¤š | âŒ |
| Context API | åŸç”Ÿ | æ€§èƒ½é—®é¢˜ | âŒ |

**é€‰æ‹© Zustand çš„åŸå› **:
- æç®€çš„ APIï¼ˆ~1KBï¼‰
- æ— éœ€ Provider åŒ…è£¹
- TypeScript æ”¯æŒå®Œç¾
- æ€§èƒ½ä¼˜ç§€
- ä¸­é—´ä»¶æ”¯æŒ

---

## ğŸ—„ï¸ æ•°æ®åº“è®¾è®¡

### ER å›¾

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”       â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”       â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚    users    â”‚       â”‚    posts    â”‚       â”‚  categories â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤       â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤       â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ id (PK)     â”‚â”€â”€â”€â”   â”‚ id (PK)     â”‚   â”Œâ”€â”€â”€â”‚ id (PK)     â”‚
â”‚ username    â”‚   â”‚   â”‚ title       â”‚   â”‚   â”‚ name        â”‚
â”‚ email       â”‚   â”‚   â”‚ slug        â”‚   â”‚   â”‚ slug        â”‚
â”‚ password    â”‚   â”‚   â”‚ content     â”‚   â”‚   â”‚ description â”‚
â”‚ role        â”‚   â”‚   â”‚ author_id(FK)â”‚â”€â”€â”€â”¤   â”‚ icon        â”‚
â”‚ created_at  â”‚   â”‚   â”‚ category_id â”‚â”€â”€â”€â”˜   â”‚ color       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚   â”‚ status      â”‚       â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                  â”‚   â”‚ created_at  â”‚
                  â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                  â”‚         â”‚
                  â”‚         â”‚ 1:N
                  â”‚         â–¼
                  â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”       â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                  â”‚   â”‚  comments   â”‚       â”‚    tags     â”‚
                  â”‚   â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤       â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
                  â””â”€â”€>â”‚ id (PK)     â”‚       â”‚ id (PK)     â”‚
                      â”‚ post_id (FK)â”‚       â”‚ name        â”‚
                      â”‚ user_id (FK)â”‚       â”‚ slug        â”‚
                      â”‚ parent_id   â”‚       â”‚ color       â”‚
                      â”‚ content     â”‚       â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                      â”‚ status      â”‚             â”‚
                      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜             â”‚ N:M
                            â”‚                     â”‚
                            â”‚ 1:N                 â–¼
                            â–¼               â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”       â”‚  post_tags  â”‚
                      â”‚    likes    â”‚       â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
                      â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤       â”‚ post_id (FK)â”‚
                      â”‚ id (PK)     â”‚       â”‚ tag_id (FK) â”‚
                      â”‚ user_id (FK)â”‚       â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                      â”‚ post_id (FK)â”‚
                      â”‚ comment_id  â”‚
                      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### æ ¸å¿ƒè¡¨ç»“æ„

#### users - ç”¨æˆ·è¡¨

```sql
CREATE TABLE users (
    id INTEGER PRIMARY KEY AUTOINCREMENT,
    username TEXT NOT NULL UNIQUE,
    email TEXT NOT NULL UNIQUE,
    password_hash TEXT,
    display_name TEXT NOT NULL,
    avatar_url TEXT,
    bio TEXT,
    role TEXT DEFAULT 'user',           -- admin/moderator/user
    status TEXT DEFAULT 'active',        -- active/suspended/deleted
    oauth_provider TEXT,                 -- github/google/null
    oauth_id TEXT,
    post_count INTEGER DEFAULT 0,
    comment_count INTEGER DEFAULT 0,
    created_at DATETIME DEFAULT CURRENT_TIMESTAMP,
    updated_at DATETIME DEFAULT CURRENT_TIMESTAMP,
    last_login_at DATETIME
);
```

**ç´¢å¼•**:
- `idx_users_username` - ç”¨æˆ·åæŸ¥è¯¢
- `idx_users_email` - é‚®ç®±æŸ¥è¯¢
- `idx_users_oauth` - OAuth ç™»å½•
- `idx_users_role` - è§’è‰²ç­›é€‰

#### posts - æ–‡ç« è¡¨

```sql
CREATE TABLE posts (
    id INTEGER PRIMARY KEY AUTOINCREMENT,
    title TEXT NOT NULL,
    slug TEXT NOT NULL UNIQUE,
    summary TEXT,
    content TEXT NOT NULL,
    cover_image TEXT,
    author_id INTEGER NOT NULL,
    category_id INTEGER,
    status TEXT DEFAULT 'draft',         -- draft/published/archived
    visibility TEXT DEFAULT 'public',    -- public/private/password
    password TEXT,
    view_count INTEGER DEFAULT 0,
    like_count INTEGER DEFAULT 0,
    comment_count INTEGER DEFAULT 0,
    reading_time INTEGER,
    meta_title TEXT,
    meta_description TEXT,
    meta_keywords TEXT,
    published_at DATETIME,
    created_at DATETIME DEFAULT CURRENT_TIMESTAMP,
    updated_at DATETIME DEFAULT CURRENT_TIMESTAMP,
    FOREIGN KEY (author_id) REFERENCES users(id),
    FOREIGN KEY (category_id) REFERENCES categories(id)
);
```

**ç´¢å¼•**:
- `idx_posts_slug` - URL æŸ¥è¯¢
- `idx_posts_author_id` - ä½œè€…æ–‡ç« 
- `idx_posts_category_id` - åˆ†ç±»æ–‡ç« 
- `idx_posts_status_published` - å·²å‘å¸ƒæ–‡ç« ï¼ˆå¤åˆç´¢å¼•ï¼‰
- `idx_posts_published_at` - æ—¶é—´æ’åº
- `idx_posts_view_count` - çƒ­é—¨æ’åº

#### comments - è¯„è®ºè¡¨

```sql
CREATE TABLE comments (
    id INTEGER PRIMARY KEY AUTOINCREMENT,
    post_id INTEGER NOT NULL,
    user_id INTEGER NOT NULL,
    parent_id INTEGER,                   -- æ”¯æŒ5å±‚åµŒå¥—
    content TEXT NOT NULL,
    status TEXT DEFAULT 'approved',      -- pending/approved/rejected/deleted
    like_count INTEGER DEFAULT 0,
    reply_count INTEGER DEFAULT 0,
    ip_address TEXT,
    user_agent TEXT,
    created_at DATETIME DEFAULT CURRENT_TIMESTAMP,
    updated_at DATETIME DEFAULT CURRENT_TIMESTAMP,
    FOREIGN KEY (post_id) REFERENCES posts(id) ON DELETE CASCADE,
    FOREIGN KEY (user_id) REFERENCES users(id) ON DELETE CASCADE,
    FOREIGN KEY (parent_id) REFERENCES comments(id) ON DELETE CASCADE
);
```

**ç´¢å¼•**:
- `idx_comments_post_id` - æ–‡ç« è¯„è®º
- `idx_comments_user_id` - ç”¨æˆ·è¯„è®º
- `idx_comments_parent_id` - è¯„è®ºå›å¤
- `idx_comments_post_status` - å·²å®¡æ ¸è¯„è®ºï¼ˆå¤åˆç´¢å¼•ï¼‰

### æ•°æ®åº“ä¼˜åŒ–ç­–ç•¥

#### 1. ç´¢å¼•ä¼˜åŒ–

```sql
-- å¤åˆç´¢å¼•ï¼šçŠ¶æ€ + å‘å¸ƒæ—¶é—´ï¼ˆè¦†ç›–æœ€å¸¸ç”¨æŸ¥è¯¢ï¼‰
CREATE INDEX idx_posts_status_published 
ON posts(status, published_at DESC) 
WHERE status = 'published';

-- éƒ¨åˆ†ç´¢å¼•ï¼šä»…å¯¹å·²å‘å¸ƒæ–‡ç« å»ºç´¢å¼•
CREATE INDEX idx_posts_visibility 
ON posts(visibility) 
WHERE status = 'published';
```

#### 2. è§¦å‘å™¨è‡ªåŠ¨ç»´æŠ¤

```sql
-- è‡ªåŠ¨æ›´æ–°æ–‡ç« è¯„è®ºæ•°
CREATE TRIGGER trg_comments_insert
AFTER INSERT ON comments
WHEN NEW.status = 'approved'
BEGIN
    UPDATE posts 
    SET comment_count = comment_count + 1
    WHERE id = NEW.post_id;
END;

-- è‡ªåŠ¨æ›´æ–°ç”¨æˆ·æ–‡ç« æ•°
CREATE TRIGGER trg_posts_insert
AFTER INSERT ON posts
WHEN NEW.status = 'published'
BEGIN
    UPDATE users 
    SET post_count = post_count + 1
    WHERE id = NEW.author_id;
END;
```

#### 3. è§†å›¾ç®€åŒ–æŸ¥è¯¢

```sql
-- æ–‡ç« è¯¦æƒ…è§†å›¾ï¼ˆå‡å°‘JOINï¼‰
CREATE VIEW vw_posts_detailed AS
SELECT 
    p.*,
    u.username as author_username,
    u.display_name as author_name,
    u.avatar_url as author_avatar,
    c.name as category_name,
    c.slug as category_slug,
    c.color as category_color
FROM posts p
LEFT JOIN users u ON p.author_id = u.id
LEFT JOIN categories c ON p.category_id = c.id;
```

---

## ğŸ”§ åç«¯æ¶æ„

### é¡¹ç›®ç»“æ„

```
backend/
â”œâ”€â”€ src/
â”‚   â”œâ”€â”€ index.ts                # ä¸»å…¥å£
â”‚   â”œâ”€â”€ middleware/             # ä¸­é—´ä»¶å±‚
â”‚   â”‚   â”œâ”€â”€ auth.ts            # JWT è®¤è¯
â”‚   â”‚   â”œâ”€â”€ rateLimit.ts       # é€Ÿç‡é™åˆ¶
â”‚   â”‚   â””â”€â”€ requestLogger.ts   # è¯·æ±‚æ—¥å¿—
â”‚   â”œâ”€â”€ routes/                # è·¯ç”±å±‚
â”‚   â”‚   â”œâ”€â”€ auth.ts            # è®¤è¯è·¯ç”±
â”‚   â”‚   â”œâ”€â”€ posts.ts           # æ–‡ç« è·¯ç”±
â”‚   â”‚   â”œâ”€â”€ comments.ts        # è¯„è®ºè·¯ç”±
â”‚   â”‚   â”œâ”€â”€ categories.ts      # åˆ†ç±»æ ‡ç­¾è·¯ç”±
â”‚   â”‚   â”œâ”€â”€ upload.ts          # æ–‡ä»¶ä¸Šä¼ è·¯ç”±
â”‚   â”‚   â”œâ”€â”€ analytics.ts       # æ•°æ®ç»Ÿè®¡è·¯ç”±
â”‚   â”‚   â”œâ”€â”€ admin.ts           # ç®¡ç†å‘˜è·¯ç”±
â”‚   â”‚   â””â”€â”€ config.ts          # é…ç½®è·¯ç”±
â”‚   â”œâ”€â”€ utils/                 # å·¥å…·å±‚
â”‚   â”‚   â”œâ”€â”€ cache.ts           # ç¼“å­˜å·¥å…·
â”‚   â”‚   â”œâ”€â”€ jwt.ts             # JWT å·¥å…·
â”‚   â”‚   â”œâ”€â”€ validation.ts      # æ•°æ®éªŒè¯
â”‚   â”‚   â”œâ”€â”€ response.ts        # å“åº”æ ¼å¼åŒ–
â”‚   â”‚   â””â”€â”€ resend.ts          # é‚®ä»¶æœåŠ¡
â”‚   â””â”€â”€ types/                 # ç±»å‹å®šä¹‰
â”‚       â””â”€â”€ index.ts
â”œâ”€â”€ wrangler.toml              # Workers é…ç½®
â””â”€â”€ package.json
```

### åˆ†å±‚æ¶æ„

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚           è·¯ç”±å±‚ (Routes)                â”‚
â”‚  - å®šä¹‰ API ç«¯ç‚¹                         â”‚
â”‚  - å‚æ•°éªŒè¯                              â”‚
â”‚  - è°ƒç”¨ä¸šåŠ¡é€»è¾‘                          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                 â”‚
                 â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚         ä¸­é—´ä»¶å±‚ (Middleware)            â”‚
â”‚  - è®¤è¯æˆæƒ (JWT)                        â”‚
â”‚  - é€Ÿç‡é™åˆ¶ (IP/User)                    â”‚
â”‚  - CORS å¤„ç†                             â”‚
â”‚  - è¯·æ±‚æ—¥å¿—                              â”‚
â”‚  - é”™è¯¯å¤„ç†                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                 â”‚
                 â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚         ä¸šåŠ¡é€»è¾‘å±‚ (Business)            â”‚
â”‚  - æ ¸å¿ƒä¸šåŠ¡é€»è¾‘                          â”‚
â”‚  - æ•°æ®å¤„ç†å’Œè½¬æ¢                        â”‚
â”‚  - æƒé™æ£€æŸ¥                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                 â”‚
                 â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚          æ•°æ®è®¿é—®å±‚ (Data)               â”‚
â”‚  - æ•°æ®åº“æŸ¥è¯¢ (D1)                       â”‚
â”‚  - ç¼“å­˜è¯»å†™ (KV)                         â”‚
â”‚  - æ–‡ä»¶æ“ä½œ (R2)                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### æ ¸å¿ƒæ¨¡å—è®¾è®¡

#### 1. è®¤è¯ç³»ç»Ÿ

```typescript
// JWT è®¤è¯æµç¨‹
export async function requireAuth(c: Context, next: Next) {
  // 1. æå– Token
  const token = c.req.header('Authorization')?.replace('Bearer ', '');
  
  if (!token) {
    return c.json(errorResponse('Unauthorized'), 401);
  }
  
  try {
    // 2. éªŒè¯ Token
    const payload = await verifyToken(token, c.env.JWT_SECRET);
    
    // 3. æ£€æŸ¥é»‘åå•
    const isBlacklisted = await safeGetCache(c.env, `token_blacklist:${token}`);
    if (isBlacklisted) {
      return c.json(errorResponse('Tokenå·²å¤±æ•ˆ'), 401);
    }
    
    // 4. æŸ¥è¯¢ç”¨æˆ·
    const user = await c.env.DB.prepare(
      'SELECT * FROM users WHERE id = ? AND status = "active"'
    ).bind(payload.userId).first();
    
    if (!user) {
      return c.json(errorResponse('ç”¨æˆ·ä¸å­˜åœ¨'), 401);
    }
    
    // 5. æ³¨å…¥ç”¨æˆ·ä¿¡æ¯
    c.set('user', user);
    await next();
    
  } catch (error) {
    return c.json(errorResponse('Tokenæ— æ•ˆ'), 401);
  }
}
```

#### 2. é€Ÿç‡é™åˆ¶

```typescript
// æ™ºèƒ½é€Ÿç‡é™åˆ¶
export async function rateLimiter(c: Context, next: Next) {
  const ip = c.req.header('CF-Connecting-IP') || 'unknown';
  const endpoint = c.req.path;
  
  // æ ¹æ®ç«¯ç‚¹è®¾ç½®ä¸åŒé™åˆ¶
  const limits = {
    '/api/auth/login': { max: 50, window: 86400 },    // 50æ¬¡/å¤©
    '/api/upload': { max: 20, window: 3600 },         // 20æ¬¡/å°æ—¶
    '/default': { max: 500, window: 86400 }           // 500æ¬¡/å¤©
  };
  
  const limit = limits[endpoint] || limits.default;
  const key = `rate:${ip}:${endpoint}`;
  
  // è·å–å½“å‰è®¡æ•°
  const count = await c.env.CACHE.get(key);
  const current = count ? parseInt(count) : 0;
  
  if (current >= limit.max) {
    return c.json(errorResponse('Rate limit exceeded'), 429);
  }
  
  // å¢åŠ è®¡æ•°
  await c.env.CACHE.put(
    key, 
    String(current + 1), 
    { expirationTtl: limit.window }
  );
  
  await next();
}
```

#### 3. ç¼“å­˜ç­–ç•¥

```typescript
// å¤šå±‚ç¼“å­˜æ¶æ„
export class CacheManager {
  // çƒ­ç‚¹æ•°æ®ç¼“å­˜ (1å°æ—¶)
  async getHotPosts(env: Env): Promise<Post[]> {
    const cached = await safeGetCache(env, 'hot_posts');
    if (cached) return JSON.parse(cached);
    
    const posts = await fetchHotPosts(env);
    await safePutCache(env, 'hot_posts', JSON.stringify(posts), 3600);
    return posts;
  }
  
  // ç”¨æˆ·æ•°æ®ç¼“å­˜ (5åˆ†é’Ÿ)
  async getUserById(env: Env, id: number): Promise<User> {
    const key = `user:${id}`;
    const cached = await safeGetCache(env, key);
    if (cached) return JSON.parse(cached);
    
    const user = await fetchUser(env, id);
    await safePutCache(env, key, JSON.stringify(user), 300);
    return user;
  }
  
  // é…ç½®ç¼“å­˜ (24å°æ—¶)
  async getSiteConfig(env: Env): Promise<Config> {
    const cached = await safeGetCache(env, 'site_config');
    if (cached) return JSON.parse(cached);
    
    const config = await fetchConfig(env);
    await safePutCache(env, 'site_config', JSON.stringify(config), 86400);
    return config;
  }
}
```

---

## ğŸ¨ å‰ç«¯æ¶æ„

### é¡¹ç›®ç»“æ„

```
frontend/
â”œâ”€â”€ public/                    # é™æ€èµ„æº
â”‚   â”œâ”€â”€ logo.png
â”‚   â””â”€â”€ favicon.ico
â”œâ”€â”€ src/
â”‚   â”œâ”€â”€ components/           # å…¬å…±ç»„ä»¶
â”‚   â”‚   â”œâ”€â”€ Header.tsx
â”‚   â”‚   â”œâ”€â”€ Footer.tsx
â”‚   â”‚   â”œâ”€â”€ ThemeToggle.tsx
â”‚   â”‚   â”œâ”€â”€ PostEditor.tsx    # Markdown ç¼–è¾‘å™¨
â”‚   â”‚   â”œâ”€â”€ CategoryManager.tsx
â”‚   â”‚   â””â”€â”€ TagManager.tsx
â”‚   â”œâ”€â”€ pages/                # é¡µé¢ç»„ä»¶
â”‚   â”‚   â”œâ”€â”€ HomePage.tsx
â”‚   â”‚   â”œâ”€â”€ PostPage.tsx
â”‚   â”‚   â”œâ”€â”€ SearchPage.tsx
â”‚   â”‚   â”œâ”€â”€ LoginPage.tsx
â”‚   â”‚   â”œâ”€â”€ ProfilePage.tsx
â”‚   â”‚   â”œâ”€â”€ AdminPage.tsx
â”‚   â”‚   â””â”€â”€ ConfigPage.tsx
â”‚   â”œâ”€â”€ stores/               # Zustand çŠ¶æ€
â”‚   â”‚   â”œâ”€â”€ authStore.ts      # è®¤è¯çŠ¶æ€
â”‚   â”‚   â””â”€â”€ themeStore.ts     # ä¸»é¢˜çŠ¶æ€
â”‚   â”œâ”€â”€ hooks/                # è‡ªå®šä¹‰ Hooks
â”‚   â”‚   â”œâ”€â”€ useApiRequest.ts  # API è¯·æ±‚
â”‚   â”‚   â”œâ”€â”€ useSiteConfig.ts  # é…ç½®è·å–
â”‚   â”‚   â””â”€â”€ useVerificationCountdown.ts
â”‚   â”œâ”€â”€ utils/                # å·¥å…·å‡½æ•°
â”‚   â”‚   â””â”€â”€ api.ts            # API å®¢æˆ·ç«¯
â”‚   â”œâ”€â”€ types/                # TypeScript ç±»å‹
â”‚   â”‚   â””â”€â”€ index.ts
â”‚   â”œâ”€â”€ App.tsx               # æ ¹ç»„ä»¶
â”‚   â”œâ”€â”€ main.tsx              # å…¥å£æ–‡ä»¶
â”‚   â””â”€â”€ index.css             # å…¨å±€æ ·å¼
â”œâ”€â”€ vite.config.ts            # Vite é…ç½®
â”œâ”€â”€ tailwind.config.js        # Tailwind é…ç½®
â””â”€â”€ package.json
```

### ç»„ä»¶æ¶æ„

```
App.tsx
â”œâ”€â”€ Router
â”‚   â”œâ”€â”€ Layout
â”‚   â”‚   â”œâ”€â”€ Header
â”‚   â”‚   â”‚   â”œâ”€â”€ Logo
â”‚   â”‚   â”‚   â”œâ”€â”€ Navigation
â”‚   â”‚   â”‚   â””â”€â”€ UserMenu
â”‚   â”‚   â”œâ”€â”€ Main (Routes)
â”‚   â”‚   â”‚   â”œâ”€â”€ HomePage
â”‚   â”‚   â”‚   â”œâ”€â”€ PostPage
â”‚   â”‚   â”‚   â”œâ”€â”€ SearchPage
â”‚   â”‚   â”‚   â””â”€â”€ ...
â”‚   â”‚   â””â”€â”€ Footer
â”‚   â”‚       â”œâ”€â”€ SocialLinks
â”‚   â”‚       â””â”€â”€ Copyright
```

### çŠ¶æ€ç®¡ç†

```typescript
// authStore.ts - è®¤è¯çŠ¶æ€
interface AuthState {
  user: User | null;
  token: string | null;
  isAuthenticated: boolean;
  login: (credentials: Credentials) => Promise<void>;
  logout: () => void;
  updateProfile: (data: ProfileData) => Promise<void>;
}

export const useAuthStore = create<AuthState>((set) => ({
  user: null,
  token: localStorage.getItem('token'),
  isAuthenticated: false,
  
  login: async (credentials) => {
    const response = await api.post('/auth/login', credentials);
    localStorage.setItem('token', response.token);
    set({ user: response.user, token: response.token, isAuthenticated: true });
  },
  
  logout: () => {
    localStorage.removeItem('token');
    set({ user: null, token: null, isAuthenticated: false });
  },
  
  updateProfile: async (data) => {
    const response = await api.put('/auth/profile', data);
    set({ user: response.user });
  }
}));

// themeStore.ts - ä¸»é¢˜çŠ¶æ€
interface ThemeState {
  mode: 'light' | 'dark' | 'system';
  setMode: (mode: ThemeMode) => void;
  toggle: () => void;
}

export const useThemeStore = create<ThemeState>((set) => ({
  mode: localStorage.getItem('theme') as ThemeMode || 'system',
  
  setMode: (mode) => {
    localStorage.setItem('theme', mode);
    set({ mode });
  },
  
  toggle: () => set((state) => ({
    mode: state.mode === 'light' ? 'dark' : 'light'
  }))
}));
```

### è·¯ç”±è®¾è®¡

```typescript
// App.tsx
function App() {
  return (
    <Router>
      <Routes>
        {/* å…¬å¼€è·¯ç”± */}
        <Route path="/" element={<HomePage />} />
        <Route path="/posts/:slug" element={<PostPage />} />
        <Route path="/search" element={<SearchPage />} />
        <Route path="/about" element={<AboutPage />} />
        
        {/* è®¤è¯è·¯ç”± */}
        <Route path="/login" element={<LoginPage />} />
        
        {/* å—ä¿æŠ¤è·¯ç”± */}
        <Route element={<PrivateRoute />}>
          <Route path="/profile" element={<ProfilePage />} />
          <Route path="/posts/new" element={<PostEditor />} />
          <Route path="/posts/:id/edit" element={<PostEditor />} />
        </Route>
        
        {/* ç®¡ç†å‘˜è·¯ç”± */}
        <Route element={<AdminRoute />}>
          <Route path="/admin" element={<AdminPage />} />
          <Route path="/admin/users" element={<UserManagement />} />
          <Route path="/admin/comments" element={<CommentModeration />} />
          <Route path="/admin/settings" element={<Settings />} />
        </Route>
        
        {/* 404 */}
        <Route path="*" element={<NotFound />} />
      </Routes>
    </Router>
  );
}
```

---

## ğŸ”’ å®‰å…¨è®¾è®¡

### 1. è®¤è¯å®‰å…¨

```typescript
// å¯†ç åŠ å¯†
const hashedPassword = await bcrypt.hash(password, 12);

// JWT ç­¾å
const token = await generateToken(
  { userId, role },
  secret,
  { expiresIn: '7d' }
);

// Token åˆ·æ–°æœºåˆ¶
async function refreshToken(oldToken: string) {
  const payload = await verifyToken(oldToken);
  
  // æ£€æŸ¥æ˜¯å¦åœ¨åˆ·æ–°çª—å£æœŸ
  if (payload.exp - Date.now() / 1000 > 86400) {
    throw new Error('Token è¿˜æœªåˆ°åˆ·æ–°æ—¶é—´');
  }
  
  return generateToken({ userId: payload.userId, role: payload.role });
}
```

### 2. è¾“å…¥éªŒè¯

```typescript
// ç”¨æˆ·åéªŒè¯
export function validateUsername(username: string): string | null {
  if (!username || username.length < 3) {
    return 'ç”¨æˆ·åè‡³å°‘3ä¸ªå­—ç¬¦';
  }
  if (username.length > 20) {
    return 'ç”¨æˆ·åæœ€å¤š20ä¸ªå­—ç¬¦';
  }
  if (!/^[a-zA-Z0-9_]+$/.test(username)) {
    return 'ç”¨æˆ·ååªèƒ½åŒ…å«å­—æ¯ã€æ•°å­—å’Œä¸‹åˆ’çº¿';
  }
  return null;
}

// é‚®ç®±éªŒè¯
export function validateEmail(email: string): string | null {
  const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
  if (!emailRegex.test(email)) {
    return 'é‚®ç®±æ ¼å¼ä¸æ­£ç¡®';
  }
  return null;
}

// å¯†ç éªŒè¯
export function validatePassword(password: string): string | null {
  if (password.length < 8) {
    return 'å¯†ç è‡³å°‘8ä¸ªå­—ç¬¦';
  }
  if (!/[a-z]/.test(password)) {
    return 'å¯†ç å¿…é¡»åŒ…å«å°å†™å­—æ¯';
  }
  if (!/[A-Z]/.test(password)) {
    return 'å¯†ç å¿…é¡»åŒ…å«å¤§å†™å­—æ¯';
  }
  if (!/[0-9]/.test(password)) {
    return 'å¯†ç å¿…é¡»åŒ…å«æ•°å­—';
  }
  if (!/[!@#$%^&*]/.test(password)) {
    return 'å¯†ç å¿…é¡»åŒ…å«ç‰¹æ®Šå­—ç¬¦';
  }
  return null;
}

// XSS é˜²æŠ¤
export function sanitizeInput(input: string): string {
  return input
    .replace(/</g, '&lt;')
    .replace(/>/g, '&gt;')
    .replace(/"/g, '&quot;')
    .replace(/'/g, '&#x27;')
    .replace(/\//g, '&#x2F;');
}
```

### 3. SQL æ³¨å…¥é˜²æŠ¤

```typescript
// ä½¿ç”¨å‚æ•°åŒ–æŸ¥è¯¢
const result = await env.DB.prepare(
  'SELECT * FROM users WHERE username = ? AND status = ?'
).bind(username, 'active').first();

// é¿å…å­—ç¬¦ä¸²æ‹¼æ¥ï¼ˆé”™è¯¯ç¤ºä¾‹ï¼‰
// const query = `SELECT * FROM users WHERE username = '${username}'`; // âŒ å±é™©ï¼
```

### 4. CSRF é˜²æŠ¤

```typescript
// æ£€æŸ¥ Origin å’Œ Referer
app.use('*', async (c, next) => {
  const origin = c.req.header('Origin');
  const referer = c.req.header('Referer');
  
  if (c.req.method !== 'GET' && c.req.method !== 'HEAD') {
    if (!origin && !referer) {
      return c.json(errorResponse('CSRF check failed'), 403);
    }
    
    const allowedOrigins = ['https://blog.neutronx.uk'];
    if (origin && !allowedOrigins.includes(origin)) {
      return c.json(errorResponse('CSRF check failed'), 403);
    }
  }
  
  await next();
});
```

### 5. æƒé™æ§åˆ¶

```typescript
// åŸºäºè§’è‰²çš„è®¿é—®æ§åˆ¶ (RBAC)
const permissions = {
  admin: ['*'],  // æ‰€æœ‰æƒé™
  moderator: [
    'comments:read',
    'comments:update',
    'comments:delete',
    'posts:read',
    'posts:update'
  ],
  user: [
    'posts:read',
    'posts:create',
    'posts:update:own',
    'comments:create',
    'comments:update:own'
  ]
};

function hasPermission(user: User, permission: string): boolean {
  const userPermissions = permissions[user.role];
  
  if (userPermissions.includes('*')) {
    return true;
  }
  
  return userPermissions.includes(permission);
}

// èµ„æºæ‰€æœ‰æƒæ£€æŸ¥
async function canEditPost(user: User, postId: number, env: Env): Promise<boolean> {
  if (user.role === 'admin') {
    return true;
  }
  
  const post = await env.DB.prepare(
    'SELECT author_id FROM posts WHERE id = ?'
  ).bind(postId).first();
  
  return post && post.author_id === user.id;
}
```

---

## âš¡ æ€§èƒ½ä¼˜åŒ–

### 1. ç¼“å­˜ç­–ç•¥

```typescript
// ä¸‰çº§ç¼“å­˜æ¶æ„
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Browser Cache â”‚  (é™æ€èµ„æºï¼Œ1å¹´)
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Cloudflare CDNâ”‚  (è¾¹ç¼˜ç¼“å­˜ï¼Œ1å°æ—¶)
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   KV Storage   â”‚  (çƒ­ç‚¹æ•°æ®ï¼Œè‡ªå®šä¹‰TTL)
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   D1 Database  â”‚  (æŒä¹…åŒ–å­˜å‚¨)
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 2. æ•°æ®åº“æŸ¥è¯¢ä¼˜åŒ–

```typescript
// ä½¿ç”¨ç´¢å¼•
const posts = await env.DB.prepare(`
  SELECT * FROM posts
  WHERE status = 'published' AND visibility = 'public'
  ORDER BY published_at DESC
  LIMIT ? OFFSET ?
`).bind(limit, offset).all();

// é¿å… N+1 æŸ¥è¯¢
const postsWithAuthors = await env.DB.prepare(`
  SELECT 
    p.*,
    u.username, u.display_name, u.avatar_url
  FROM posts p
  LEFT JOIN users u ON p.author_id = u.id
  WHERE p.status = 'published'
  LIMIT ?
`).bind(limit).all();

// æ‰¹é‡æ“ä½œ
await env.DB.batch([
  env.DB.prepare('UPDATE posts SET view_count = view_count + 1 WHERE id = ?').bind(1),
  env.DB.prepare('UPDATE posts SET view_count = view_count + 1 WHERE id = ?').bind(2),
  env.DB.prepare('UPDATE posts SET view_count = view_count + 1 WHERE id = ?').bind(3)
]);
```

### 3. å‰ç«¯ä¼˜åŒ–

```typescript
// è·¯ç”±çº§ä»£ç åˆ†å‰²
const AdminPage = lazy(() => import('./pages/AdminPage'));
const PostEditor = lazy(() => import('./components/PostEditor'));

// å›¾ç‰‡æ‡’åŠ è½½
<img 
  src={post.coverImage}
  loading="lazy"
  alt={post.title}
/>

// è™šæ‹Ÿæ»šåŠ¨ï¼ˆå¤§åˆ—è¡¨ï¼‰
import { useVirtualizer } from '@tanstack/react-virtual';

function PostList({ posts }) {
  const virtualizer = useVirtualizer({
    count: posts.length,
    getScrollElement: () => parentRef.current,
    estimateSize: () => 100,
  });
  
  return (
    <div ref={parentRef} style={{ height: '500px', overflow: 'auto' }}>
      {virtualizer.getVirtualItems().map((virtualRow) => (
        <div key={virtualRow.index}>
          {posts[virtualRow.index].title}
        </div>
      ))}
    </div>
  );
}

// é˜²æŠ–å’ŒèŠ‚æµ
import { debounce } from 'lodash';

const handleSearch = debounce(async (keyword: string) => {
  const results = await searchPosts(keyword);
  setResults(results);
}, 300);
```

### 4. èµ„æºä¼˜åŒ–

```bash
# Gzip/Brotli å‹ç¼©
# è‡ªåŠ¨ç”± Cloudflare å¤„ç†

# å›¾ç‰‡ä¼˜åŒ–
- ä½¿ç”¨ WebP æ ¼å¼
- å“åº”å¼å›¾ç‰‡ï¼ˆsrcsetï¼‰
- æ‡’åŠ è½½
- å°ºå¯¸é™åˆ¶ï¼ˆ5MBï¼‰

# CSS ä¼˜åŒ–
- Tailwind è‡ªåŠ¨å»é™¤æœªä½¿ç”¨çš„ç±»
- Critical CSS å†…è”
- éå…³é”®CSSå¼‚æ­¥åŠ è½½

# JavaScript ä¼˜åŒ–
- ä»£ç åˆ†å‰²
- Tree Shaking
- å‹ç¼©æ··æ·†ï¼ˆç”Ÿäº§æ„å»ºï¼‰
```

---

## ğŸš€ éƒ¨ç½²æ¶æ„

### CI/CD æµç¨‹

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Git Push   â”‚
â”‚  to Main    â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜
       â”‚
       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚    GitHub Actions           â”‚
â”‚                             â”‚
â”‚  1. Checkout Code           â”‚
â”‚  2. Install Dependencies    â”‚
â”‚  3. Run Tests               â”‚
â”‚  4. Build Frontend          â”‚
â”‚  5. Deploy Backend Worker   â”‚
â”‚  6. Deploy Frontend Pages   â”‚
â”‚  7. Send Notifications      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚
       â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
       â–¼              â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Cloudflare â”‚  â”‚  Cloudflare â”‚
â”‚   Workers   â”‚  â”‚    Pages    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### ç¯å¢ƒç®¡ç†

```
Development (æœ¬åœ°)
â”œâ”€â”€ Frontend: localhost:5173
â”œâ”€â”€ Backend: localhost:8787
â””â”€â”€ Database: wrangler dev --local

Staging (æµ‹è¯•)
â”œâ”€â”€ Frontend: staging.blog.neutronx.uk
â”œâ”€â”€ Backend: api-staging.blog.neutronx.uk
â””â”€â”€ Database: blog-db-staging

Production (ç”Ÿäº§)
â”œâ”€â”€ Frontend: blog.neutronx.uk
â”œâ”€â”€ Backend: apiblog.neutronx.uk
â””â”€â”€ Database: blog-db
```

### ç›‘æ§å’Œæ—¥å¿—

```typescript
// æ€§èƒ½ç›‘æ§
app.use('*', async (c, next) => {
  const start = Date.now();
  await next();
  const duration = Date.now() - start;
  
  // è®°å½•æ…¢æŸ¥è¯¢
  if (duration > 1000) {
    console.warn(`Slow request: ${c.req.url} took ${duration}ms`);
  }
  
  // å‘é€åˆ°åˆ†ææœåŠ¡
  c.env.ANALYTICS?.writeDataPoint({
    doubles: [duration],
    blobs: [c.req.url],
    indexes: [c.req.method]
  });
});

// é”™è¯¯è¿½è¸ª
app.onError((err, c) => {
  console.error('Application Error:', {
    message: err.message,
    stack: err.stack,
    url: c.req.url,
    method: c.req.method,
    timestamp: new Date().toISOString()
  });
  
  return c.json(errorResponse('Internal Server Error'), 500);
});
```

---

## ğŸ“ å¼€å‘è§„èŒƒ

### ä»£ç é£æ ¼

```typescript
// ä½¿ç”¨ ESLint + Prettier
{
  "extends": [
    "eslint:recommended",
    "plugin:@typescript-eslint/recommended",
    "plugin:react/recommended",
    "prettier"
  ],
  "rules": {
    "no-console": "warn",
    "prefer-const": "error",
    "@typescript-eslint/no-explicit-any": "error"
  }
}
```

### Git æäº¤è§„èŒƒ

```
feat: æ·»åŠ æ–°åŠŸèƒ½
fix: ä¿®å¤ bug
docs: æ–‡æ¡£æ›´æ–°
style: ä»£ç æ ¼å¼è°ƒæ•´ï¼ˆä¸å½±å“åŠŸèƒ½ï¼‰
refactor: ä»£ç é‡æ„
test: æµ‹è¯•ç›¸å…³
chore: æ„å»º/å·¥å…·é“¾ç›¸å…³

ç¤ºä¾‹ï¼š
feat(auth): æ·»åŠ  GitHub OAuth ç™»å½•
fix(posts): ä¿®å¤æ–‡ç« æœç´¢ç»“æœä¸å‡†ç¡®çš„é—®é¢˜
docs(api): æ›´æ–° API æ–‡æ¡£
```

### æ–‡ä»¶å‘½åè§„èŒƒ

```
- ç»„ä»¶æ–‡ä»¶ï¼šPascalCase (Header.tsx, PostCard.tsx)
- å·¥å…·æ–‡ä»¶ï¼šcamelCase (api.ts, cache.ts)
- ç±»å‹æ–‡ä»¶ï¼šPascalCase (User.ts, Post.ts)
- å¸¸é‡æ–‡ä»¶ï¼šUPPER_CASE (CONSTANTS.ts)
- æ ·å¼æ–‡ä»¶ï¼škebab-case (header.module.css)
```

### TypeScript æœ€ä½³å®è·µ

```typescript
// ä½¿ç”¨æ¥å£å®šä¹‰æ•°æ®ç»“æ„
interface User {
  id: number;
  username: string;
  email: string;
  role: 'admin' | 'moderator' | 'user';
}

// ä½¿ç”¨ç±»å‹ä¿æŠ¤
function isAdmin(user: User): boolean {
  return user.role === 'admin';
}

// é¿å…ä½¿ç”¨ any
function fetchData<T>(url: string): Promise<T> {
  return fetch(url).then(res => res.json());
}

// ä½¿ç”¨æšä¸¾
enum PostStatus {
  Draft = 'draft',
  Published = 'published',
  Archived = 'archived'
}
```

---

## ğŸ“š å‚è€ƒèµ„æ–™

- [Cloudflare Workers æ–‡æ¡£](https://developers.cloudflare.com/workers/)
- [D1 æ•°æ®åº“æ–‡æ¡£](https://developers.cloudflare.com/d1/)
- [Hono æ¡†æ¶æ–‡æ¡£](https://hono.dev/)
- [React å®˜æ–¹æ–‡æ¡£](https://react.dev/)
- [TypeScript æ‰‹å†Œ](https://www.typescriptlang.org/docs/)

---

<div align="center">

**æ¶æ„æ–‡æ¡£ç‰ˆæœ¬**: v3.0.1  
**æœ€åæ›´æ–°**: 2024-01-15

[è¿”å›é¡¶éƒ¨](#-é¡¹ç›®æ¶æ„å’ŒæŠ€æœ¯è¯¦è§£)

</div>
