name = "blog-api"
main = "src/index.ts"
compatibility_date = "2024-01-01"

# Worker设置
workers_dev = false
route = { pattern = "apiblog.neutronx.uk/*", zone_name = "neutronx.uk" }

# D1 数据库
[[d1_databases]]
binding = "DB"
database_name = "blog-db"
database_id = "1edddff8-c00a-48b5-b33b-e0e6c14ddff4"

# KV 缓存
[[kv_namespaces]]
binding = "CACHE"
id = "69c0b7cfff1d48769cc2bd29f2d9711f"

# R2 存储
[[r2_buckets]]
binding = "STORAGE"
bucket_name = "blog-storage"

# 日志配置
[observability]
enabled = true
head_sampling_rate = 1

[observability.logs]
enabled = true
head_sampling_rate = 1
persist = true
invocation_logs = true

# 定时任务触发器
[triggers]
crons = ["0 8 * * *", "0 9 * * 1"]

# 环境变量（公开的配置）
[vars]
ENVIRONMENT = "production"
FRONTEND_URL = "https://blog.neutronx.uk"
STORAGE_PUBLIC_URL = "https://storage.blog.neutronx.uk"

# Secrets（需要通过命令行或Cloudflare Dashboard设置）
# wrangler secret put JWT_SECRET
# wrangler secret put GITHUB_CLIENT_ID
# wrangler secret put GITHUB_CLIENT_SECRET

# 或者在Cloudflare Dashboard设置:
# Workers & Pages > blog-api > Settings > Variables
# 添加以下环境变量（加密）：
# - JWT_SECRET: 你的JWT密钥
# - GITHUB_CLIENT_ID: GitHub OAuth Client ID
# - GITHUB_CLIENT_SECRET: GitHub OAuth Client Secret
